# Исправление ошибки "Credential access key has length 33, should be 32"

## Проблема

Ошибка возникает, когда `AWS_ACCESS_KEY_ID` имеет неправильную длину (33 символа вместо 32).

## Причины

1. **Лишний пробел** в конце или начале ключа в `.env` файле
2. **Перенос строки** в ключе
3. **Неправильное копирование** из Cloudflare Dashboard

## Решение

### Шаг 1: Проверьте .env файл

Откройте `.env` файл в `nuvia-back` и проверьте строки с credentials:

```env
AWS_ACCESS_KEY_ID="ваш-ключ-здесь"
AWS_SECRET_ACCESS_KEY="ваш-секрет-здесь"
```

### Шаг 2: Убедитесь, что нет лишних символов

1. **Удалите кавычки**, если они есть вокруг значений:
   ```env
   # ❌ Неправильно
   AWS_ACCESS_KEY_ID="ключ с пробелами "
   
   # ✅ Правильно
   AWS_ACCESS_KEY_ID=ключбезпробелов
   ```

2. **Или используйте кавычки правильно** (без пробелов внутри):
   ```env
   # ✅ Правильно
   AWS_ACCESS_KEY_ID="ключбезпробелов"
   ```

3. **Проверьте, что нет пробелов** в начале или конце:
   ```env
   # ❌ Неправильно (пробел в конце)
   AWS_ACCESS_KEY_ID=ключ 
   
   # ✅ Правильно
   AWS_ACCESS_KEY_ID=ключ
   ```

### Шаг 3: Пересоздайте ключи в Cloudflare (если нужно)

Если проблема сохраняется:

1. Зайдите в Cloudflare Dashboard
2. R2 → Manage R2 API Tokens
3. Удалите старый токен
4. Создайте новый токен
5. **Скопируйте ключи аккуратно**, без лишних пробелов

### Шаг 4: Перезапустите backend

После исправления `.env`:

```bash
cd nuvia-back
# Остановите текущий процесс (Ctrl+C)
npm run start:dev
```

### Шаг 5: Проверьте логи

При запуске backend вы увидите:
- ✅ Если все правильно - никаких ошибок
- ❌ Если есть проблема - увидите детальную информацию о длине ключа

## Пример правильного .env

```env
# Cloudflare R2
AWS_ACCESS_KEY_ID=abc123def456ghi789jkl012mno345pq
AWS_SECRET_ACCESS_KEY=xyz789uvw456rst123opq890lmn567ijk234efg901hij678cde345
AWS_REGION=auto
AWS_S3_BUCKET_NAME=nuvia-uploads
AWS_S3_ENDPOINT=https://7c4a953fdb9ae73b3d0d97a92065be9d.r2.cloudflarestorage.com
R2_PUBLIC_DOMAIN=https://pub-1234567890abcdef.r2.dev
```

**Важно:**
- Access Key ID должен быть **ровно 32 символа**
- Secret Access Key обычно длиннее (64+ символов)
- Никаких пробелов в начале или конце
- Если используете кавычки, убедитесь, что внутри них нет пробелов

## Автоматическая очистка

Код теперь автоматически удаляет пробелы из credentials при запуске, но лучше исправить `.env` файл вручную.

